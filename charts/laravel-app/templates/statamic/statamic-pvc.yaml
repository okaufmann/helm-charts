{{- $mypvc := (lookup "v1" "PersistentVolumeClaim" .Release.Namespace (printf "%s-statamic-pvc" (include "laravel-app.fullname" .))) }}
{{- if not $mypvc }}
  {{- if .Values.statamic.enabled  -}}
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ include "laravel-app.fullname" . }}-statamic-pvc
  labels:
    {{- include "laravel-app.labels" . | nindent 4 }}
    app.kubernetes.io/component: statamic
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "4"
    helm.sh/resource-policy: keep
spec:
  storageClassName: {{ .Values.statamic.persistence.storageClass }}
  accessModes:
    - {{ .Values.statamic.persistence.accessMode | default "ReadWriteMany" | quote }}
  resources:
    requests:
      storage: {{ .Values.statamic.persistence.size | quote }}
  {{- end -}}
{{- end -}}